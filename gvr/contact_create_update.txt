FIELDS TO SAVE
==============

contact.msisdn
contact.key
contact.user_account

contact.extra.is_registered
contact.extra.is_registered_by
contact.extra.language_choice
contact.extra.sa_id
contact.extra.passport_no
contact.extra.passport_origin
contact.extra.clinic_code
contact.extra.dob
contact.extra.last_service_rating

contact.extra.source


PERSONAL
========

states_start  // OK
    contact.extra.is_registered  >  'false' | 'true'  // SAVE
    contact.extra.is_registered_by  >  'clinic' | 'chw' | 'personal'  // SAVE

go.utils.set_language(self.im.user, self.contact)  // OK
    contact.extra.language_choice  // SAVE

go.utils.subscription_count_active(self.contact, self.im)  // OK
    contact.msisdn  // SAVE




OPTOUT
======

go.utils.set_language(self.im.user, self.contact)  // OK
    contact.extra.language_choice  // SAVE

go.utils.opted_out(self.im, self.contact)  // OK
    contact.msisdn  // SAVE

go.utils.opt_out(self.im, self.contact, self.im.user.answers.states_start,
                 api_optout=false, unsub_all=true, jembi_optout=true,
                 self.metric_prefix, self.env)  // OK

    go.utils.jembi_optout_send_json(contact, contact, 'optout', im,
                                    metric_prefix);  // OK

        go.utils.build_json_doc(im, contact, user, type)  // OK
            go.utils.get_swt(im)  // OK
            contact.msisdn  // SAVE
            contact.msisdn  // SAVE
            go.utils.get_patient_id(contact)  // OK
                contact.extra.sa_id  // SAVE
                contact.extra.passport_no  // SAVE
                contact.extra.passport_origin  // SAVE
                contact.msisdn  // SAVE
            go.utils.get_subscription_type(type)  // OK
            contact.extra.language_choice  // SAVE
            go.utils.get_timestamp()  // OK
            go.utils.get_faccode(contact)  // OK
                contact.extra.clinic_code  // SAVE
            go.utils.get_dob(contact)  // OK
                contact.extra.dob  // SAVE
        };

        go.utils.get_optoutreason(contact);  // OK

go.utils.loss_message_opt_in(self.im, self.contact, self.metric_prefix,
                             self.env, opts)  // OK

        go.utils.opt_in(im, contact)  // OK

        go.utils.subscription_send_doc(contact, im, metric_prefix, env, opts)  // OK
            contact.key  // SAVE
            contact.extra.language_choice  // SAVE
            contact.msisdn  // SAVE
            contact.user_account  // SAVE

        go.utils.jembi_send_json(contact, contact, 'babyloss', im, metric_prefix)  // OK

go.utils.adjust_percentage_optouts(self.im, self.env)  // OK


SERVICERATING
=============

states_start
    contact.extra.is_registered_by = 'clinic' // SAVE
    contact.extra.last_service_rating = 'never' // SAVE



SMSINBOUND
==========

go.utils.opt_out(self.im, self.contact, optout_reason='unknown',
                 api_optout=true, unsub_all=true, jembi_optout=true,
                 self.metric_prefix, self.env)  // OK

go.utils.opt_in(self.im, self.contact)  // OK

go.utils.subscription_unsubscribe_all(self.contact, self.im)
    contact.msisdn  // SAVE

go.utils.subscription_send_doc(self.contact, self.im, self.metric_prefix,
                               self.env, opts)  // OK

go.utils.support_log_ticket(self.im.msg.content, self.contact, self.im,
                            self.metric_prefix)
    contact.key  // SAVE
    contact.msisdn  // SAVE

